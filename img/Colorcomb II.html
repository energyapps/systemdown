<!DOCTYPE html>
<!-- saved from url=(0048)http://bl.ocks.org/mbostock/85d7dce6fca6277f75fe -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8">
<title>Colorcomb II</title>
<link rel="icon" href="http://bl.ocks.org/favicon.png">
<style>

@import url("/style.css?20120730");

header,
footer {
  color: #555;
}

a.gist {
  color: #000;
}

</style>

<style type="text/css"></style></head><body><div id="StayFocusd-infobar" style="display: none; top: 0px;">
    <img src="chrome-extension://laankejkbhbdhmipfmgcngdelahlfoji/common/img/eye_19x19_red.png">
    <span id="StayFocusd-infobar-msg"></span>
    <span id="StayFocusd-infobar-links">
        <a id="StayFocusd-infobar-never-show">hide forever</a>&nbsp;&nbsp;|&nbsp;&nbsp;
        <a id="StayFocusd-infobar-hide">hide once</a>
    </span>
</div><header>
  <a href="http://bl.ocks.org/mbostock">mbostock</a>â€™s block
  <a class="gist" title="View gist #85d7dce6fca6277f75fe on GitHub" href="https://gist.github.com/mbostock/85d7dce6fca6277f75fe">#85d7dce6fca6277f75fe</a>
  <span class="date">July 10, 2015</span>
</header>

<h1>Colorcomb II</h1>


<iframe src="./Colorcomb II_files/saved_resource.html" marginwidth="0" marginheight="0" scrolling="no"></iframe>
<p></p><aside><a style="position:relative;top:6px;" href="http://bl.ocks.org/mbostock/raw/85d7dce6fca6277f75fe/" target="_blank">Open in a new window.</a></aside>


<div class="gist-readme"></div>

<div class="gist-sources"><div class="gist-source"><h2>index.html<a name="index.html" href="http://bl.ocks.org/mbostock/85d7dce6fca6277f75fe#index.html">#</a></h2><pre><code class="html xml"><span class="doctype">&lt;!DOCTYPE html&gt;</span>
<span class="tag">&lt;<span class="title">meta</span> <span class="attribute">charset</span>=<span class="value">"utf-8"</span>&gt;</span>
<span class="tag">&lt;<span class="title">style</span>&gt;</span><span class="css">

<span class="tag">body</span> <span class="rules">{
  <span class="rule"><span class="attribute">background</span>:<span class="value"> <span class="number">#000</span></span>;</span>
<span class="rule">}</span></span>

</span><span class="tag">&lt;/<span class="title">style</span>&gt;</span>
<span class="tag">&lt;<span class="title">canvas</span> <span class="attribute">width</span>=<span class="value">"960"</span> <span class="attribute">height</span>=<span class="value">"500"</span>&gt;</span><span class="tag">&lt;/<span class="title">canvas</span>&gt;</span>
<span class="tag">&lt;<span class="title">script</span>&gt;</span><span class="javascript">

<span class="comment">/* https://github.com/d3/d3-voronoi Copyright 2015 Mike Bostock */</span>
!<span class="function"><span class="keyword">function</span><span class="params">(e,t)</span>{</span><span class="string">"object"</span>==<span class="keyword">typeof</span> exports&amp;&amp;<span class="string">"undefined"</span>!=<span class="keyword">typeof</span> module?t(exports):<span class="string">"function"</span>==<span class="keyword">typeof</span> define&amp;&amp;define.amd?define([<span class="string">"exports"</span>],t):t(e.voronoi={})}(<span class="keyword">this</span>,<span class="function"><span class="keyword">function</span><span class="params">(e)</span>{</span><span class="string">"use strict"</span>;<span class="function"><span class="keyword">function</span> <span class="title">t</span><span class="params">(e)</span>{</span><span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">()</span>{</span><span class="keyword">return</span> e}}<span class="function"><span class="keyword">function</span> <span class="title">n</span><span class="params">(e,t,n)</span>{</span><span class="keyword">return</span>(e.x-n.x)*(t.y-e.y)-(e.x-t.x)*(n.y-e.y)}<span class="function"><span class="keyword">function</span> <span class="title">i</span><span class="params">(e,t)</span>{</span><span class="keyword">return</span> t.angle-e.angle}<span class="function"><span class="keyword">function</span> <span class="title">r</span><span class="params">(e,t)</span>{</span><span class="keyword">this</span>.l=e,<span class="keyword">this</span>.r=t,<span class="keyword">this</span>.a=<span class="keyword">this</span>.b=<span class="literal">null</span>}<span class="function"><span class="keyword">function</span> <span class="title">s</span><span class="params">(e,t,n)</span>{</span><span class="keyword">var</span> i=<span class="keyword">new</span> r(e,<span class="literal">null</span>);<span class="keyword">return</span> i.a=t,i.b=n,D.push(i),i}<span class="function"><span class="keyword">function</span> <span class="title">u</span><span class="params">(e,t,n)</span>{</span><span class="keyword">this</span>.edge=e,<span class="keyword">this</span>.site=t,<span class="keyword">this</span>.angle=n}<span class="function"><span class="keyword">function</span> <span class="title">f</span><span class="params">(e,t,n)</span>{</span><span class="keyword">var</span> i=e.a,r=e.b;<span class="keyword">return</span> <span class="keyword">new</span> u(e,t,n?Math.atan2(n.y-t.y,n.x-t.x):e.l===t?Math.atan2(r.x-i.x,i.y-r.y):Math.atan2(i.x-r.x,r.y-i.y))}<span class="function"><span class="keyword">function</span> <span class="title">a</span><span class="params">(e,t,n,i)</span>{</span><span class="keyword">for</span>(<span class="keyword">var</span> r,u,a,l,o,c,h,y,x,v,g=B.length;g--;)<span class="keyword">if</span>(o=B[g],o&amp;&amp;o.prepare())<span class="keyword">for</span>(h=o.edges,y=h.length,c=<span class="number">0</span>;y&gt;c;)v=h[c].end(),a=v.x,l=v.y,x=h[++c%y].start(),r=x.x,u=x.y,(Math.abs(a-r)&gt;I||Math.abs(l-u)&gt;I)&amp;&amp;(h.splice(c,<span class="number">0</span>,f(s(o.site,v,Math.abs(a-e)&lt;I&amp;&amp;i-l&gt;I?{x:e,y:Math.abs(r-e)&lt;I?u:i}:Math.abs(l-i)&lt;I&amp;&amp;n-a&gt;I?{x:Math.abs(u-i)&lt;I?r:n,y:i}:Math.abs(a-n)&lt;I&amp;&amp;l-t&gt;I?{x:n,y:Math.abs(r-n)&lt;I?u:t}:Math.abs(l-t)&lt;I&amp;&amp;a-e&gt;I?{x:Math.abs(u-t)&lt;I?r:e,y:t}:<span class="literal">null</span>),o.site,<span class="literal">null</span>)),++y)}<span class="function"><span class="keyword">function</span> <span class="title">l</span><span class="params">(e,t,n,i,r)</span>{</span><span class="keyword">var</span> s,u=e.a,f=e.b,a=u.x,l=u.y,o=f.x,c=f.y,h=<span class="number">0</span>,y=<span class="number">1</span>,x=o-a,v=c-l;<span class="keyword">if</span>(s=t-a,x||!(s&gt;<span class="number">0</span>)){<span class="keyword">if</span>(s/=x,<span class="number">0</span>&gt;x){<span class="keyword">if</span>(h&gt;s)<span class="keyword">return</span>;y&gt;s&amp;&amp;(y=s)}<span class="keyword">else</span> <span class="keyword">if</span>(x&gt;<span class="number">0</span>){<span class="keyword">if</span>(s&gt;y)<span class="keyword">return</span>;s&gt;h&amp;&amp;(h=s)}<span class="keyword">if</span>(s=i-a,x||!(<span class="number">0</span>&gt;s)){<span class="keyword">if</span>(s/=x,<span class="number">0</span>&gt;x){<span class="keyword">if</span>(s&gt;y)<span class="keyword">return</span>;s&gt;h&amp;&amp;(h=s)}<span class="keyword">else</span> <span class="keyword">if</span>(x&gt;<span class="number">0</span>){<span class="keyword">if</span>(h&gt;s)<span class="keyword">return</span>;y&gt;s&amp;&amp;(y=s)}<span class="keyword">if</span>(s=n-l,v||!(s&gt;<span class="number">0</span>)){<span class="keyword">if</span>(s/=v,<span class="number">0</span>&gt;v){<span class="keyword">if</span>(h&gt;s)<span class="keyword">return</span>;y&gt;s&amp;&amp;(y=s)}<span class="keyword">else</span> <span class="keyword">if</span>(v&gt;<span class="number">0</span>){<span class="keyword">if</span>(s&gt;y)<span class="keyword">return</span>;s&gt;h&amp;&amp;(h=s)}<span class="keyword">if</span>(s=r-l,v||!(<span class="number">0</span>&gt;s)){<span class="keyword">if</span>(s/=v,<span class="number">0</span>&gt;v){<span class="keyword">if</span>(s&gt;y)<span class="keyword">return</span>;s&gt;h&amp;&amp;(h=s)}<span class="keyword">else</span> <span class="keyword">if</span>(v&gt;<span class="number">0</span>){<span class="keyword">if</span>(h&gt;s)<span class="keyword">return</span>;y&gt;s&amp;&amp;(y=s)}<span class="keyword">return</span> h&gt;<span class="number">0</span>&amp;&amp;(e.a={x:a+h*x,y:l+h*v}),<span class="number">1</span>&gt;y&amp;&amp;(e.b={x:a+y*x,y:l+y*v}),e}}}}}<span class="function"><span class="keyword">function</span> <span class="title">o</span><span class="params">(e,t,n,i,r)</span>{</span><span class="keyword">var</span> s=e.b;<span class="keyword">if</span>(s)<span class="keyword">return</span>!<span class="number">0</span>;<span class="keyword">var</span> u,f,a=e.a,l=e.l,o=e.r,c=l.x,h=l.y,y=o.x,x=o.y,v=(c+y)/<span class="number">2</span>,g=(h+x)/<span class="number">2</span>;<span class="keyword">if</span>(x===h){<span class="keyword">if</span>(t&gt;v||v&gt;=i)<span class="keyword">return</span>;<span class="keyword">if</span>(c&gt;y){<span class="keyword">if</span>(a){<span class="keyword">if</span>(a.y&gt;=r)<span class="keyword">return</span>}<span class="keyword">else</span> a={x:v,y:n};s={x:v,y:r}}<span class="keyword">else</span>{<span class="keyword">if</span>(a){<span class="keyword">if</span>(a.y&lt;n)<span class="keyword">return</span>}<span class="keyword">else</span> a={x:v,y:r};s={x:v,y:n}}}<span class="keyword">else</span> <span class="keyword">if</span>(u=(c-y)/(x-h),f=g-u*v,-<span class="number">1</span>&gt;u||u&gt;<span class="number">1</span>)<span class="keyword">if</span>(c&gt;y){<span class="keyword">if</span>(a){<span class="keyword">if</span>(a.y&gt;=r)<span class="keyword">return</span>}<span class="keyword">else</span> a={x:(n-f)/u,y:n};s={x:(r-f)/u,y:r}}<span class="keyword">else</span>{<span class="keyword">if</span>(a){<span class="keyword">if</span>(a.y&lt;n)<span class="keyword">return</span>}<span class="keyword">else</span> a={x:(r-f)/u,y:r};s={x:(n-f)/u,y:n}}<span class="keyword">else</span> <span class="keyword">if</span>(x&gt;h){<span class="keyword">if</span>(a){<span class="keyword">if</span>(a.x&gt;=i)<span class="keyword">return</span>}<span class="keyword">else</span> a={x:t,y:u*t+f};s={x:i,y:u*i+f}}<span class="keyword">else</span>{<span class="keyword">if</span>(a){<span class="keyword">if</span>(a.x&lt;t)<span class="keyword">return</span>}<span class="keyword">else</span> a={x:i,y:u*i+f};s={x:t,y:u*t+f}}<span class="keyword">return</span> e.a=a,e.b=s,!<span class="number">0</span>}<span class="function"><span class="keyword">function</span> <span class="title">c</span><span class="params">(e,t,n,i)</span>{</span><span class="keyword">for</span>(<span class="keyword">var</span> r,s=D.length;s--;)r=D[s],(!o(r,e,t,n,i)||!l(r,e,t,n,i)||Math.abs(r.a.x-r.b.x)&lt;I&amp;&amp;Math.abs(r.a.y-r.b.y)&lt;I)&amp;&amp;(r.a=r.b=<span class="literal">null</span>,D.splice(s,<span class="number">1</span>))}<span class="function"><span class="keyword">function</span> <span class="title">h</span><span class="params">(e)</span>{</span>e.U=e.C=e.L=e.R=e.P=e.N=<span class="literal">null</span>}<span class="function"><span class="keyword">function</span> <span class="title">y</span><span class="params">(e)</span>{</span><span class="keyword">var</span> t=e.circle;t&amp;&amp;(t.P||(J=t.N),F.remove(t),K.push(t),h(t),e.circle=<span class="literal">null</span>)}<span class="function"><span class="keyword">function</span> <span class="title">x</span><span class="params">()</span>{</span>h(<span class="keyword">this</span>),<span class="keyword">this</span>.x=<span class="keyword">this</span>.y=<span class="keyword">this</span>.arc=<span class="keyword">this</span>.site=<span class="keyword">this</span>.cy=<span class="literal">null</span>}<span class="function"><span class="keyword">function</span> <span class="title">v</span><span class="params">(e)</span>{</span><span class="keyword">var</span> t=e.P,n=e.N;<span class="keyword">if</span>(t&amp;&amp;n){<span class="keyword">var</span> i=t.site,r=e.site,s=n.site;<span class="keyword">if</span>(i!==s){<span class="keyword">var</span> u=r.x,f=r.y,a=i.x-u,l=i.y-f,o=s.x-u,c=s.y-f,h=<span class="number">2</span>*(a*c-l*o);<span class="keyword">if</span>(!(h&gt;=-O)){<span class="keyword">var</span> y=a*a+l*l,v=o*o+c*c,g=(c*y-l*v)/h,C=(a*v-o*y)/h,c=C+f,d=K.pop()||<span class="keyword">new</span> x;d.arc=e,d.site=r,d.x=g+u,d.y=c+Math.sqrt(g*g+C*C),d.cy=c,e.circle=d;<span class="keyword">for</span>(<span class="keyword">var</span> p=<span class="literal">null</span>,L=F._;L;)<span class="keyword">if</span>(d.y&lt;L.y||d.y===L.y&amp;&amp;d.x&lt;=L.x){<span class="keyword">if</span>(!L.L){p=L.P;<span class="keyword">break</span>}L=L.L}<span class="keyword">else</span>{<span class="keyword">if</span>(!L.R){p=L;<span class="keyword">break</span>}L=L.R}F.insert(p,d),p||(J=d)}}}}<span class="function"><span class="keyword">function</span> <span class="title">g</span><span class="params">(e,t,n,i)</span>{</span>e.a||e.b?e.l===n?e.b=i:e.a=i:(e.a=i,e.l=t,e.r=n)}<span class="function"><span class="keyword">function</span> <span class="title">C</span><span class="params">(e,t,n,i)</span>{</span><span class="keyword">var</span> s=<span class="keyword">new</span> r(e,t);<span class="keyword">return</span> D.push(s),n&amp;&amp;g(s,e,t,n),i&amp;&amp;g(s,t,e,i),B[e.i].edges.push(f(s,e,t)),B[t.i].edges.push(f(s,t,e)),s}<span class="function"><span class="keyword">function</span> <span class="title">d</span><span class="params">()</span>{</span>h(<span class="keyword">this</span>),<span class="keyword">this</span>.edge=<span class="keyword">this</span>.site=<span class="keyword">this</span>.circle=<span class="literal">null</span>}<span class="function"><span class="keyword">function</span> <span class="title">p</span><span class="params">(e)</span>{</span><span class="keyword">var</span> t=Q.pop()||<span class="keyword">new</span> d;<span class="keyword">return</span> t.site=e,t}<span class="function"><span class="keyword">function</span> <span class="title">L</span><span class="params">(e)</span>{</span>y(e),G.remove(e),Q.push(e),h(e)}<span class="function"><span class="keyword">function</span> <span class="title">b</span><span class="params">(e)</span>{</span><span class="keyword">var</span> t=e.circle,n=t.x,i=t.cy,r={x:n,y:i},s=e.P,u=e.N,f=[e];L(e);<span class="keyword">for</span>(<span class="keyword">var</span> a=s;a.circle&amp;&amp;Math.abs(n-a.circle.x)&lt;I&amp;&amp;Math.abs(i-a.circle.cy)&lt;I;)s=a.P,f.unshift(a),L(a),a=s;f.unshift(a),y(a);<span class="keyword">for</span>(<span class="keyword">var</span> l=u;l.circle&amp;&amp;Math.abs(n-l.circle.x)&lt;I&amp;&amp;Math.abs(i-l.circle.cy)&lt;I;)u=l.N,f.push(l),L(l),l=u;f.push(l),y(l);<span class="keyword">var</span> o,c=f.length;<span class="keyword">for</span>(o=<span class="number">1</span>;c&gt;o;++o)l=f[o],a=f[o-<span class="number">1</span>],g(l.edge,a.site,l.site,r);a=f[<span class="number">0</span>],l=f[c-<span class="number">1</span>],l.edge=C(a.site,l.site,<span class="literal">null</span>,r),v(a),v(l)}<span class="function"><span class="keyword">function</span> <span class="title">R</span><span class="params">(e)</span>{</span><span class="keyword">this</span>.site=e,<span class="keyword">this</span>.edges=[]}<span class="function"><span class="keyword">function</span> <span class="title">M</span><span class="params">(e)</span>{</span><span class="keyword">return</span> B[e.i]=<span class="keyword">new</span> R(e)}<span class="function"><span class="keyword">function</span> <span class="title">U</span><span class="params">(e,t)</span>{</span><span class="keyword">var</span> n=e.site,i=n.x,r=n.y,s=r-t;<span class="keyword">if</span>(!s)<span class="keyword">return</span> i;<span class="keyword">var</span> u=e.P;<span class="keyword">if</span>(!u)<span class="keyword">return</span>-(<span class="number">1</span>/<span class="number">0</span>);n=u.site;<span class="keyword">var</span> f=n.x,a=n.y,l=a-t;<span class="keyword">if</span>(!l)<span class="keyword">return</span> f;<span class="keyword">var</span> o=f-i,c=<span class="number">1</span>/s-<span class="number">1</span>/l,h=o/l;<span class="keyword">return</span> c?(-h+Math.sqrt(h*h-<span class="number">2</span>*c*(o*o/(-<span class="number">2</span>*l)-a+l/<span class="number">2</span>+r-s/<span class="number">2</span>)))/c+i:(i+f)/<span class="number">2</span>}<span class="function"><span class="keyword">function</span> <span class="title">N</span><span class="params">(e,t)</span>{</span><span class="keyword">var</span> n=e.N;<span class="keyword">if</span>(n)<span class="keyword">return</span> U(n,t);<span class="keyword">var</span> i=e.site;<span class="keyword">return</span> i.y===t?i.x:<span class="number">1</span>/<span class="number">0</span>}<span class="function"><span class="keyword">function</span> <span class="title">P</span><span class="params">(e)</span>{</span><span class="keyword">for</span>(<span class="keyword">var</span> t,n,i,r,s=e.x,u=e.y,f=G._;f;)<span class="keyword">if</span>(i=U(f,u)-s,i&gt;I)f=f.L;<span class="keyword">else</span>{<span class="keyword">if</span>(r=s-N(f,u),!(r&gt;I)){i&gt;-I?(t=f.P,n=f):r&gt;-I?(t=f,n=f.N):t=n=f;<span class="keyword">break</span>}<span class="keyword">if</span>(!f.R){t=f;<span class="keyword">break</span>}f=f.R}M(e);<span class="keyword">var</span> a=p(e);<span class="keyword">if</span>(G.insert(t,a),t||n){<span class="keyword">if</span>(t===n)<span class="keyword">return</span> y(t),n=p(t.site),G.insert(a,n),a.edge=n.edge=C(t.site,a.site),v(t),<span class="keyword">void</span> v(n);<span class="keyword">if</span>(!n)<span class="keyword">return</span> <span class="keyword">void</span>(a.edge=C(t.site,a.site));y(t),y(n);<span class="keyword">var</span> l=t.site,o=l.x,c=l.y,h=e.x-o,x=e.y-c,d=n.site,L=d.x-o,b=d.y-c,R=<span class="number">2</span>*(h*b-x*L),P=h*h+x*x,_=L*L+b*b,m={x:(b*P-x*_)/R+o,y:(h*_-L*P)/R+c};g(n.edge,l,d,m),a.edge=C(l,e,<span class="literal">null</span>,m),n.edge=C(e,d,<span class="literal">null</span>,m),v(t),v(n)}}<span class="function"><span class="keyword">function</span> <span class="title">_</span><span class="params">()</span>{</span><span class="keyword">this</span>._=<span class="literal">null</span>}<span class="function"><span class="keyword">function</span> <span class="title">m</span><span class="params">(e,t)</span>{</span><span class="keyword">var</span> n=t,i=t.L,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.L=i.R,n.L&amp;&amp;(n.L.U=n),i.R=n}<span class="function"><span class="keyword">function</span> <span class="title">w</span><span class="params">(e,t)</span>{</span><span class="keyword">var</span> n=t,i=t.R,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.R=i.L,n.R&amp;&amp;(n.R.U=n),i.L=n}<span class="function"><span class="keyword">function</span> <span class="title">k</span><span class="params">(e)</span>{</span><span class="keyword">for</span>(;e.L;)e=e.L;<span class="keyword">return</span> e}<span class="function"><span class="keyword">function</span> <span class="title">q</span><span class="params">(e,t)</span>{</span><span class="keyword">return</span> t.y-e.y||t.x-e.x}<span class="function"><span class="keyword">function</span> <span class="title">A</span><span class="params">(e,t)</span>{</span><span class="keyword">var</span> n,i,r,s=e.sort(q).pop();<span class="keyword">for</span>(D=[],B=<span class="keyword">new</span> Array(e.length),G=<span class="keyword">new</span> _,F=<span class="keyword">new</span> _;;)<span class="keyword">if</span>(r=J,s&amp;&amp;(!r||s.y&lt;r.y||s.y===r.y&amp;&amp;s.x&lt;r.x))(s.x!==n||s.y!==i)&amp;&amp;(P(s),n=s.x,i=s.y),s=e.pop();<span class="keyword">else</span>{<span class="keyword">if</span>(!r)<span class="keyword">break</span>;b(r.arc)}<span class="keyword">if</span>(t){<span class="keyword">var</span> n=t[<span class="number">0</span>][<span class="number">0</span>],i=t[<span class="number">0</span>][<span class="number">1</span>],u=t[<span class="number">1</span>][<span class="number">0</span>],f=t[<span class="number">1</span>][<span class="number">1</span>];c(n,i,u,f),a(n,i,u,f)}<span class="keyword">var</span> l={cells:B,edges:D};<span class="keyword">return</span> G=F=D=B=<span class="literal">null</span>,l}<span class="function"><span class="keyword">function</span> <span class="title">E</span><span class="params">(e)</span>{</span><span class="keyword">return</span> e[<span class="number">1</span>]}<span class="function"><span class="keyword">function</span> <span class="title">j</span><span class="params">(e)</span>{</span><span class="keyword">return</span> e[<span class="number">0</span>]}<span class="function"><span class="keyword">function</span> <span class="title">z</span><span class="params">()</span>{</span><span class="function"><span class="keyword">function</span> <span class="title">e</span><span class="params">(e)</span>{</span><span class="keyword">var</span> t=<span class="keyword">new</span> Array(e.length),n=l[<span class="number">0</span>][<span class="number">0</span>],i=l[<span class="number">0</span>][<span class="number">1</span>],s=l[<span class="number">1</span>][<span class="number">0</span>],u=l[<span class="number">1</span>][<span class="number">1</span>];<span class="keyword">return</span> A(r(e),l).cells.forEach(<span class="function"><span class="keyword">function</span><span class="params">(r,f)</span>{</span><span class="keyword">var</span> a=r.edges,l=r.site,o=t[f]=a.length?a.map(<span class="function"><span class="keyword">function</span><span class="params">(e)</span>{</span><span class="keyword">var</span> t=e.start();<span class="keyword">return</span>[t.x,t.y]}):l.x&gt;=n&amp;&amp;l.x&lt;=s&amp;&amp;l.y&gt;=i&amp;&amp;l.y&lt;=u?[[n,u],[s,u],[s,i],[n,i]]:[];o.point=e[f]}),t}<span class="function"><span class="keyword">function</span> <span class="title">r</span><span class="params">(e)</span>{</span><span class="keyword">return</span> e.map(<span class="function"><span class="keyword">function</span><span class="params">(e,t)</span>{</span><span class="keyword">return</span>{x:Math.round(f(e,t)/I)*I,y:Math.round(a(e,t)/I)*I,i:t}})}<span class="keyword">var</span> s=j,u=E,f=s,a=u,l=H;<span class="keyword">return</span> e.links=<span class="function"><span class="keyword">function</span><span class="params">(e)</span>{</span><span class="keyword">return</span> A(r(e)).edges.filter(<span class="function"><span class="keyword">function</span><span class="params">(e)</span>{</span><span class="keyword">return</span> e.l&amp;&amp;e.r}).map(<span class="function"><span class="keyword">function</span><span class="params">(t)</span>{</span><span class="keyword">return</span>{source:e[t.l.i],target:e[t.r.i]}})},e.triangles=<span class="function"><span class="keyword">function</span><span class="params">(e)</span>{</span><span class="keyword">var</span> t=[];<span class="keyword">return</span> A(r(e)).cells.forEach(<span class="function"><span class="keyword">function</span><span class="params">(r,s)</span>{</span><span class="keyword">for</span>(<span class="keyword">var</span> u,f,a=r.site,l=r.edges.sort(i),o=-<span class="number">1</span>,c=l.length,h=l[c-<span class="number">1</span>].edge,y=h.l===a?h.r:h.l;++o&lt;c;)u=h,f=y,h=l[o].edge,y=h.l===a?h.r:h.l,s&lt;f.i&amp;&amp;s&lt;y.i&amp;&amp;n(a,f,y)&lt;<span class="number">0</span>&amp;&amp;t.push([e[s],e[f.i],e[y.i]])}),t},e.x=<span class="function"><span class="keyword">function</span><span class="params">(n)</span>{</span><span class="keyword">return</span> arguments.length?(s=n,f=<span class="string">"function"</span>==<span class="keyword">typeof</span> n?s:t(s),e):s},e.y=<span class="function"><span class="keyword">function</span><span class="params">(n)</span>{</span><span class="keyword">return</span> arguments.length?(u=n,a=<span class="string">"function"</span>==<span class="keyword">typeof</span> n?u:t(u),e):u},e.extent=<span class="function"><span class="keyword">function</span><span class="params">(t)</span>{</span><span class="keyword">return</span> arguments.length?(l=<span class="literal">null</span>==t?H:t,e):l===H?<span class="literal">null</span>:l},e.size=<span class="function"><span class="keyword">function</span><span class="params">(t)</span>{</span><span class="keyword">return</span> arguments.length?e.extent(t&amp;&amp;[[<span class="number">0</span>,<span class="number">0</span>],t]):l===H?<span class="literal">null</span>:l&amp;&amp;l[<span class="number">1</span>]},e}<span class="keyword">var</span> B,D,F,G,H=[[-<span class="number">1</span>e6,-<span class="number">1</span>e6],[<span class="number">1</span>e6,<span class="number">1</span>e6]],I=<span class="number">1</span>e-<span class="number">6</span>;u.prototype={start:<span class="function"><span class="keyword">function</span><span class="params">()</span>{</span><span class="keyword">return</span> <span class="keyword">this</span>.edge.l===<span class="keyword">this</span>.site?<span class="keyword">this</span>.edge.a:<span class="keyword">this</span>.edge.b},end:<span class="function"><span class="keyword">function</span><span class="params">()</span>{</span><span class="keyword">return</span> <span class="keyword">this</span>.edge.l===<span class="keyword">this</span>.site?<span class="keyword">this</span>.edge.b:<span class="keyword">this</span>.edge.a}};<span class="keyword">var</span> J,K=[],O=<span class="number">1</span>e-<span class="number">12</span>,Q=[];R.prototype.prepare=<span class="function"><span class="keyword">function</span><span class="params">()</span>{</span><span class="keyword">for</span>(<span class="keyword">var</span> e,t=<span class="keyword">this</span>.edges,n=t.length;n--;)e=t[n].edge,e.b&amp;&amp;e.a||t.splice(n,<span class="number">1</span>);<span class="keyword">return</span> t.sort(i),t.length},_.prototype={insert:<span class="function"><span class="keyword">function</span><span class="params">(e,t)</span>{</span><span class="keyword">var</span> n,i,r;<span class="keyword">if</span>(e){<span class="keyword">if</span>(t.P=e,t.N=e.N,e.N&amp;&amp;(e.N.P=t),e.N=t,e.R){<span class="keyword">for</span>(e=e.R;e.L;)e=e.L;e.L=t}<span class="keyword">else</span> e.R=t;n=e}<span class="keyword">else</span> <span class="keyword">this</span>._?(e=k(<span class="keyword">this</span>._),t.P=<span class="literal">null</span>,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=<span class="literal">null</span>,<span class="keyword">this</span>._=t,n=<span class="literal">null</span>);<span class="keyword">for</span>(t.L=t.R=<span class="literal">null</span>,t.U=n,t.C=!<span class="number">0</span>,e=t;n&amp;&amp;n.C;)i=n.U,n===i.L?(r=i.R,r&amp;&amp;r.C?(n.C=r.C=!<span class="number">1</span>,i.C=!<span class="number">0</span>,e=i):(e===n.R&amp;&amp;(w(<span class="keyword">this</span>,n),e=n,n=e.U),n.C=!<span class="number">1</span>,i.C=!<span class="number">0</span>,m(<span class="keyword">this</span>,i))):(r=i.L,r&amp;&amp;r.C?(n.C=r.C=!<span class="number">1</span>,i.C=!<span class="number">0</span>,e=i):(e===n.L&amp;&amp;(m(<span class="keyword">this</span>,n),e=n,n=e.U),n.C=!<span class="number">1</span>,i.C=!<span class="number">0</span>,w(<span class="keyword">this</span>,i))),n=e.U;<span class="keyword">this</span>._.C=!<span class="number">1</span>},remove:<span class="function"><span class="keyword">function</span><span class="params">(e)</span>{</span>e.N&amp;&amp;(e.N.P=e.P),e.P&amp;&amp;(e.P.N=e.N),e.N=e.P=<span class="literal">null</span>;<span class="keyword">var</span> t,n,i,r=e.U,s=e.L,u=e.R;<span class="keyword">if</span>(n=s?u?k(u):s:u,r?r.L===e?r.L=n:r.R=n:<span class="keyword">this</span>._=n,s&amp;&amp;u?(i=n.C,n.C=e.C,n.L=s,s.U=n,n!==u?(r=n.U,n.U=e.U,e=n.R,r.L=e,n.R=u,u.U=n):(n.U=r,r=n,e=n.R)):(i=e.C,e=n),e&amp;&amp;(e.U=r),!i){<span class="keyword">if</span>(e&amp;&amp;e.C)<span class="keyword">return</span> <span class="keyword">void</span>(e.C=!<span class="number">1</span>);<span class="keyword">do</span>{<span class="keyword">if</span>(e===<span class="keyword">this</span>._)<span class="keyword">break</span>;<span class="keyword">if</span>(e===r.L){<span class="keyword">if</span>(t=r.R,t.C&amp;&amp;(t.C=!<span class="number">1</span>,r.C=!<span class="number">0</span>,w(<span class="keyword">this</span>,r),t=r.R),t.L&amp;&amp;t.L.C||t.R&amp;&amp;t.R.C){t.R&amp;&amp;t.R.C||(t.L.C=!<span class="number">1</span>,t.C=!<span class="number">0</span>,m(<span class="keyword">this</span>,t),t=r.R),t.C=r.C,r.C=t.R.C=!<span class="number">1</span>,w(<span class="keyword">this</span>,r),e=<span class="keyword">this</span>._;<span class="keyword">break</span>}}<span class="keyword">else</span> <span class="keyword">if</span>(t=r.L,t.C&amp;&amp;(t.C=!<span class="number">1</span>,r.C=!<span class="number">0</span>,m(<span class="keyword">this</span>,r),t=r.L),t.L&amp;&amp;t.L.C||t.R&amp;&amp;t.R.C){t.L&amp;&amp;t.L.C||(t.R.C=!<span class="number">1</span>,t.C=!<span class="number">0</span>,w(<span class="keyword">this</span>,t),t=r.L),t.C=r.C,r.C=t.L.C=!<span class="number">1</span>,m(<span class="keyword">this</span>,r),e=<span class="keyword">this</span>._;<span class="keyword">break</span>}t.C=!<span class="number">0</span>,e=r,r=r.U}<span class="keyword">while</span>(!e.C);e&amp;&amp;(e.C=!<span class="number">1</span>)}}},e.voronoi=z});

<span class="comment">/* https://github.com/d3/d3-timer Copyright 2015 Mike Bostock */</span>
<span class="string">"undefined"</span>==<span class="keyword">typeof</span> requestAnimationFrame&amp;&amp;(requestAnimationFrame=<span class="string">"undefined"</span>!=<span class="keyword">typeof</span> window&amp;&amp;(window.msRequestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame)||<span class="function"><span class="keyword">function</span><span class="params">(e)</span>{</span><span class="keyword">return</span> setTimeout(e,<span class="number">17</span>)}),<span class="function"><span class="keyword">function</span><span class="params">(e,n)</span>{</span><span class="string">"object"</span>==<span class="keyword">typeof</span> exports&amp;&amp;<span class="string">"undefined"</span>!=<span class="keyword">typeof</span> module?n(exports):<span class="string">"function"</span>==<span class="keyword">typeof</span> define&amp;&amp;define.amd?define([<span class="string">"exports"</span>],n):n(e.timer={})}(<span class="keyword">this</span>,<span class="function"><span class="keyword">function</span><span class="params">(e)</span>{</span><span class="string">"use strict"</span>;<span class="function"><span class="keyword">function</span> <span class="title">n</span><span class="params">()</span>{</span>r=m=<span class="number">0</span>,c=<span class="number">1</span>/<span class="number">0</span>,t(u())}<span class="function"><span class="keyword">function</span> <span class="title">t</span><span class="params">(e)</span>{</span><span class="keyword">if</span>(!r){<span class="keyword">var</span> t=e-Date.now();t&gt;<span class="number">24</span>?c&gt;e&amp;&amp;(m&amp;&amp;clearTimeout(m),m=setTimeout(n,t),c=e):(m&amp;&amp;(m=clearTimeout(m),c=<span class="number">1</span>/<span class="number">0</span>),r=requestAnimationFrame(n))}}<span class="function"><span class="keyword">function</span> <span class="title">i</span><span class="params">(e,n,i)</span>{</span>i=<span class="literal">null</span>==i?Date.now():+i,<span class="literal">null</span>!=n&amp;&amp;(i+=+n);<span class="keyword">var</span> o={callback:e,time:i,flush:!<span class="number">1</span>,next:<span class="literal">null</span>};a?a.next=o:f=o,a=o,t(i)}<span class="function"><span class="keyword">function</span> <span class="title">o</span><span class="params">(e,n,t)</span>{</span>t=<span class="literal">null</span>==t?Date.now():+t,<span class="literal">null</span>!=n&amp;&amp;(t+=+n),l.callback=e,l.time=t}<span class="function"><span class="keyword">function</span> <span class="title">u</span><span class="params">(e)</span>{</span>e=<span class="literal">null</span>==e?Date.now():+e;<span class="keyword">var</span> n=l;<span class="keyword">for</span>(l=f;l;)e&gt;=l.time&amp;&amp;(l.flush=l.callback(e-l.time,e)),l=l.next;l=n,e=<span class="number">1</span>/<span class="number">0</span>;<span class="keyword">for</span>(<span class="keyword">var</span> t,i=f;i;)i.flush?i=t?t.next=i.next:f=i.next:(i.time&lt;e&amp;&amp;(e=i.time),i=(t=i).next);<span class="keyword">return</span> a=t,e}<span class="keyword">var</span> a,m,r,f,l,c=<span class="number">1</span>/<span class="number">0</span>;e.timer=i,e.timerReplace=o,e.timerFlush=u});

<span class="comment">/* https://github.com/d3/d3-color Copyright 2015 Mike Bostock */</span>
<span class="string">"undefined"</span>==<span class="keyword">typeof</span> Map?(Map=<span class="function"><span class="keyword">function</span><span class="params">()</span>{</span><span class="keyword">this</span>.clear()},Map.prototype={set:<span class="function"><span class="keyword">function</span><span class="params">(t,e)</span>{</span><span class="keyword">return</span> <span class="keyword">this</span>._[t]=e,<span class="keyword">this</span>},get:<span class="function"><span class="keyword">function</span><span class="params">(t)</span>{</span><span class="keyword">return</span> <span class="keyword">this</span>._[t]},has:<span class="function"><span class="keyword">function</span><span class="params">(t)</span>{</span><span class="keyword">return</span> t <span class="keyword">in</span> <span class="keyword">this</span>._},<span class="string">"delete"</span>:<span class="function"><span class="keyword">function</span><span class="params">(t)</span>{</span><span class="keyword">return</span> t <span class="keyword">in</span> <span class="keyword">this</span>._&amp;&amp;<span class="keyword">delete</span> <span class="keyword">this</span>._[t]},clear:<span class="function"><span class="keyword">function</span><span class="params">()</span>{</span><span class="keyword">this</span>._=Object.create(<span class="literal">null</span>)},get size(){<span class="keyword">var</span> t=<span class="number">0</span>;<span class="keyword">for</span>(<span class="keyword">var</span> e <span class="keyword">in</span> <span class="keyword">this</span>._)++t;<span class="keyword">return</span> t},forEach:<span class="function"><span class="keyword">function</span><span class="params">(t)</span>{</span><span class="keyword">for</span>(<span class="keyword">var</span> e <span class="keyword">in</span> <span class="keyword">this</span>._)t(<span class="keyword">this</span>._[e],e,<span class="keyword">this</span>)}}):<span class="function"><span class="keyword">function</span><span class="params">()</span>{</span><span class="keyword">var</span> t=<span class="keyword">new</span> Map;t.set(<span class="number">0</span>,<span class="number">0</span>)!==t&amp;&amp;(t=t.set,Map.prototype.set=<span class="function"><span class="keyword">function</span><span class="params">()</span>{</span><span class="keyword">return</span> t.apply(<span class="keyword">this</span>,arguments),<span class="keyword">this</span>})}(),<span class="function"><span class="keyword">function</span><span class="params">(t,e)</span>{</span><span class="string">"object"</span>==<span class="keyword">typeof</span> exports&amp;&amp;<span class="string">"undefined"</span>!=<span class="keyword">typeof</span> module?e(exports):<span class="string">"function"</span>==<span class="keyword">typeof</span> define&amp;&amp;define.amd?define([<span class="string">"exports"</span>],e):e(t.color={})}(<span class="keyword">this</span>,<span class="function"><span class="keyword">function</span><span class="params">(t)</span>{</span><span class="string">"use strict"</span>;<span class="function"><span class="keyword">function</span> <span class="title">e</span><span class="params">()</span>{</span>}<span class="function"><span class="keyword">function</span> <span class="title">s</span><span class="params">(t,e,s)</span>{</span><span class="keyword">this</span>.r=Math.max(<span class="number">0</span>,Math.min(<span class="number">255</span>,Math.round(t))),<span class="keyword">this</span>.g=Math.max(<span class="number">0</span>,Math.min(<span class="number">255</span>,Math.round(e))),<span class="keyword">this</span>.b=Math.max(<span class="number">0</span>,Math.min(<span class="number">255</span>,Math.round(s)))}<span class="function"><span class="keyword">function</span> <span class="title">n</span><span class="params">(t,e,s)</span>{</span><span class="keyword">return</span> isNaN(t)&amp;&amp;(t=<span class="number">0</span>),isNaN(e)&amp;&amp;(e=<span class="number">0</span>),isNaN(s)&amp;&amp;(s=<span class="number">0</span>),<span class="string">"#"</span>+(<span class="number">16</span>&gt;t?<span class="string">"0"</span>+t.toString(<span class="number">16</span>):t.toString(<span class="number">16</span>))+(<span class="number">16</span>&gt;e?<span class="string">"0"</span>+e.toString(<span class="number">16</span>):e.toString(<span class="number">16</span>))+(<span class="number">16</span>&gt;s?<span class="string">"0"</span>+s.toString(<span class="number">16</span>):s.toString(<span class="number">16</span>))}<span class="function"><span class="keyword">function</span> <span class="title">r</span><span class="params">(t,n,r)</span>{</span><span class="keyword">return</span> <span class="number">1</span>===arguments.length&amp;&amp;(t <span class="keyword">instanceof</span> e||(t=l(t)),t?(t=t.rgb(),r=t.b,n=t.g,t=t.r):t=n=r=NaN),<span class="keyword">new</span> s(t,n,r)}<span class="function"><span class="keyword">function</span> <span class="title">i</span><span class="params">(t)</span>{</span><span class="keyword">return</span> r(t&gt;&gt;<span class="number">16</span>&amp;<span class="number">255</span>,t&gt;&gt;<span class="number">8</span>&amp;<span class="number">255</span>,<span class="number">255</span>&amp;t)}<span class="function"><span class="keyword">function</span> <span class="title">a</span><span class="params">(t,e,s)</span>{</span><span class="keyword">this</span>.h=+t,<span class="keyword">this</span>.s=Math.max(<span class="number">0</span>,Math.min(<span class="number">1</span>,+e)),<span class="keyword">this</span>.l=Math.max(<span class="number">0</span>,Math.min(<span class="number">1</span>,+s))}<span class="function"><span class="keyword">function</span> <span class="title">o</span><span class="params">(t,e,s)</span>{</span><span class="keyword">return</span> <span class="number">255</span>*(<span class="number">60</span>&gt;t?e+(s-e)*t/<span class="number">60</span>:<span class="number">180</span>&gt;t?s:<span class="number">240</span>&gt;t?e+(s-e)*(<span class="number">240</span>-t)/<span class="number">60</span>:e)}<span class="function"><span class="keyword">function</span> <span class="title">h</span><span class="params">(t,s,n)</span>{</span><span class="keyword">if</span>(<span class="number">1</span>===arguments.length)<span class="keyword">if</span>(t <span class="keyword">instanceof</span> a)n=t.l,s=t.s,t=t.h;<span class="keyword">else</span> <span class="keyword">if</span>(t <span class="keyword">instanceof</span> e||(t=l(t)),t){<span class="keyword">if</span>(t <span class="keyword">instanceof</span> a)<span class="keyword">return</span> t;t=t.rgb();<span class="keyword">var</span> r=t.r/<span class="number">255</span>,i=t.g/<span class="number">255</span>,o=t.b/<span class="number">255</span>,h=Math.min(r,i,o),u=Math.max(r,i,o),c=u-h;n=(u+h)/<span class="number">2</span>,c?(s=.<span class="number">5</span>&gt;n?c/(u+h):c/(<span class="number">2</span>-u-h),t=r===u?(i-o)/c+<span class="number">6</span>*(o&gt;i):i===u?(o-r)/c+<span class="number">2</span>:(r-i)/c+<span class="number">4</span>,t*=<span class="number">60</span>):(t=NaN,s=n&gt;<span class="number">0</span>&amp;&amp;<span class="number">1</span>&gt;n?<span class="number">0</span>:t)}<span class="keyword">else</span> t=s=n=NaN;<span class="keyword">return</span> <span class="keyword">new</span> a(t,s,n)}<span class="function"><span class="keyword">function</span> <span class="title">l</span><span class="params">(t)</span>{</span><span class="keyword">var</span> e;<span class="keyword">return</span> t=(t+<span class="string">""</span>).trim().toLowerCase(),(e=R.exec(t))?(e=parseInt(e[<span class="number">1</span>],<span class="number">16</span>),r(e&gt;&gt;<span class="number">8</span>&amp;<span class="number">15</span>|e&gt;&gt;<span class="number">4</span>&amp;<span class="number">240</span>,e&gt;&gt;<span class="number">4</span>&amp;<span class="number">15</span>|<span class="number">240</span>&amp;e,(<span class="number">15</span>&amp;e)&lt;&lt;<span class="number">4</span>|<span class="number">15</span>&amp;e)):(e=E.exec(t))?i(parseInt(e[<span class="number">1</span>],<span class="number">16</span>)):(e=z.exec(t))?r(e[<span class="number">1</span>],e[<span class="number">2</span>],e[<span class="number">3</span>]):(e=P.exec(t))?r(<span class="number">2.55</span>*e[<span class="number">1</span>],<span class="number">2.55</span>*e[<span class="number">2</span>],<span class="number">2.55</span>*e[<span class="number">3</span>]):(e=O.exec(t))?h(e[<span class="number">1</span>],.<span class="number">01</span>*e[<span class="number">2</span>],.<span class="number">01</span>*e[<span class="number">3</span>]):L.has(t)?i(L.get(t)):<span class="literal">null</span>}<span class="function"><span class="keyword">function</span> <span class="title">u</span><span class="params">(t,e,s)</span>{</span><span class="keyword">this</span>.l=+t,<span class="keyword">this</span>.a=+e,<span class="keyword">this</span>.b=+s}<span class="function"><span class="keyword">function</span> <span class="title">c</span><span class="params">(t)</span>{</span><span class="keyword">return</span> <span class="number">255</span>*(.<span class="number">0031308</span>&gt;=t?<span class="number">12.92</span>*t:<span class="number">1.055</span>*Math.pow(t,<span class="number">1</span>/<span class="number">2.4</span>)-.<span class="number">055</span>)}<span class="function"><span class="keyword">function</span> <span class="title">g</span><span class="params">(t)</span>{</span><span class="keyword">return</span> t&gt;F?t*t*t:G*(t-D)}<span class="function"><span class="keyword">function</span> <span class="title">f</span><span class="params">(t)</span>{</span><span class="keyword">return</span> t&gt;T?Math.pow(t,<span class="number">1</span>/<span class="number">3</span>):t/G+D}<span class="function"><span class="keyword">function</span> <span class="title">d</span><span class="params">(t)</span>{</span><span class="keyword">return</span>(t/=<span class="number">255</span>)&lt;=.<span class="number">04045</span>?t/<span class="number">12.92</span>:Math.pow((t+.<span class="number">055</span>)/<span class="number">1.055</span>,<span class="number">2.4</span>)}<span class="function"><span class="keyword">function</span> <span class="title">p</span><span class="params">(t,e,s)</span>{</span><span class="keyword">this</span>.h=+t,<span class="keyword">this</span>.c=+e,<span class="keyword">this</span>.l=+s}<span class="function"><span class="keyword">function</span> <span class="title">b</span><span class="params">(t,e,n)</span>{</span><span class="keyword">if</span>(<span class="number">1</span>===arguments.length)<span class="keyword">if</span>(t <span class="keyword">instanceof</span> u)n=t.b,e=t.a,t=t.l;<span class="keyword">else</span> <span class="keyword">if</span>(t <span class="keyword">instanceof</span> p){<span class="keyword">var</span> i=t.h*U;n=Math.sin(i)*t.c,e=Math.cos(i)*t.c,t=t.l}<span class="keyword">else</span>{t <span class="keyword">instanceof</span> s||(t=r(t));<span class="keyword">var</span> a=d(t.r),o=d(t.g),n=d(t.b),h=f((.<span class="number">4124564</span>*a+.<span class="number">3575761</span>*o+.<span class="number">1804375</span>*n)/K),l=f((.<span class="number">2126729</span>*a+.<span class="number">7151522</span>*o+.<span class="number">072175</span>*n)/Q),c=f((.<span class="number">0193339</span>*a+.<span class="number">119192</span>*o+.<span class="number">9503041</span>*n)/J);n=<span class="number">200</span>*(l-c),e=<span class="number">500</span>*(h-l),t=<span class="number">116</span>*l-<span class="number">16</span>}<span class="keyword">return</span> <span class="keyword">new</span> u(t,e,n)}<span class="function"><span class="keyword">function</span> <span class="title">N</span><span class="params">(t,e,s)</span>{</span><span class="keyword">return</span> <span class="number">1</span>===arguments.length&amp;&amp;(t <span class="keyword">instanceof</span> p?(s=t.l,e=t.c,t=t.h):(t <span class="keyword">instanceof</span> u||(t=b(t)),s=t.l,e=Math.sqrt(t.a*t.a+t.b*t.b),t=Math.atan2(t.b,t.a)*W,<span class="number">0</span>&gt;t&amp;&amp;(t+=<span class="number">360</span>))),<span class="keyword">new</span> p(t,e,s)}<span class="function"><span class="keyword">function</span> <span class="title">m</span><span class="params">(t,e,s)</span>{</span><span class="keyword">this</span>.h=+t,<span class="keyword">this</span>.s=+e,<span class="keyword">this</span>.l=+s}<span class="function"><span class="keyword">function</span> <span class="title">w</span><span class="params">(t,e,n)</span>{</span><span class="keyword">if</span>(<span class="number">1</span>===arguments.length)<span class="keyword">if</span>(t <span class="keyword">instanceof</span> m)n=t.l,e=t.s,t=t.h;<span class="keyword">else</span>{t <span class="keyword">instanceof</span> s||(t=r(t));<span class="keyword">var</span> i=t.r/<span class="number">255</span>,a=t.g/<span class="number">255</span>,o=t.b/<span class="number">255</span>;n=(at*o+it*i-rt*a)/(at+it-rt);<span class="keyword">var</span> h=o-n,l=(Y*(a-n)-tt*h)/Z,u=Math.pow(n,nt);e=Math.sqrt(l*l+h*h)/(Y*u*(<span class="number">1</span>-u)),t=e?Math.atan2(l,h)*W-<span class="number">120</span>:NaN,<span class="number">0</span>&gt;t&amp;&amp;(t+=<span class="number">360</span>)}<span class="keyword">return</span> <span class="keyword">new</span> m(t,e,n)}<span class="function"><span class="keyword">function</span> <span class="title">y</span><span class="params">(t,e)</span>{</span>t=w(t),e=w(e);<span class="keyword">var</span> s=isNaN(t.h)?e.h:t.h,n=isNaN(t.s)?e.s:t.s,r=t.l,i=isNaN(e.h)?<span class="number">0</span>:e.h-s,a=isNaN(e.s)?<span class="number">0</span>:e.s-n,o=e.l-r;<span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(e)</span>{</span><span class="keyword">return</span> t.h=s+i*e,t.s=n+a*e,t.l=r+o*e,t+<span class="string">""</span>}}<span class="function"><span class="keyword">function</span> <span class="title">v</span><span class="params">(t,e)</span>{</span><span class="keyword">var</span> s=(t-e)%<span class="number">360</span>;<span class="keyword">return</span> s+(s&gt;<span class="number">180</span>?-<span class="number">360</span>:-<span class="number">180</span>&gt;s?<span class="number">360</span>:<span class="number">0</span>)}<span class="function"><span class="keyword">function</span> <span class="title">M</span><span class="params">(t,e)</span>{</span>t=w(t),e=w(e);<span class="keyword">var</span> s=isNaN(t.h)?e.h:t.h,n=isNaN(t.s)?e.s:t.s,r=t.l,i=isNaN(e.h)?<span class="number">0</span>:v(e.h,s),a=isNaN(e.s)?<span class="number">0</span>:e.s-n,o=e.l-r;<span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(e)</span>{</span><span class="keyword">return</span> t.h=s+i*e,t.s=n+a*e,t.l=r+o*e,t+<span class="string">""</span>}}<span class="function"><span class="keyword">function</span> <span class="title">k</span><span class="params">(t,e)</span>{</span>t=N(t),e=N(e);<span class="keyword">var</span> s=isNaN(t.h)?e.h:t.h,n=isNaN(t.c)?e.c:t.c,r=t.l,i=isNaN(e.h)?<span class="number">0</span>:e.h-s,a=isNaN(e.c)?<span class="number">0</span>:e.c-n,o=e.l-r;<span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(e)</span>{</span><span class="keyword">return</span> t.h=s+i*e,t.c=n+a*e,t.l=r+o*e,t+<span class="string">""</span>}}<span class="function"><span class="keyword">function</span> <span class="title">x</span><span class="params">(t,e)</span>{</span>t=N(t),e=N(e);<span class="keyword">var</span> s=isNaN(t.h)?e.h:t.h,n=isNaN(t.c)?e.c:t.c,r=t.l,i=isNaN(e.h)?<span class="number">0</span>:v(e.h,s),a=isNaN(e.c)?<span class="number">0</span>:e.c-n,o=e.l-r;<span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(e)</span>{</span><span class="keyword">return</span> t.h=s+i*e,t.c=n+a*e,t.l=r+o*e,t+<span class="string">""</span>}}<span class="function"><span class="keyword">function</span> <span class="title">q</span><span class="params">(t,e)</span>{</span>t=b(t),e=b(e);<span class="keyword">var</span> s=t.l,n=t.a,r=t.b,i=e.l-s,a=e.a-n,o=e.b-r;<span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(e)</span>{</span><span class="keyword">return</span> t.l=s+i*e,t.a=n+a*e,t.b=r+o*e,t+<span class="string">""</span>}}<span class="function"><span class="keyword">function</span> <span class="title">_</span><span class="params">(t,e)</span>{</span>t=h(t),e=h(e);<span class="keyword">var</span> s=isNaN(t.h)?e.h:t.h,n=isNaN(t.s)?e.s:t.s,r=t.l,i=isNaN(e.h)?<span class="number">0</span>:e.h-s,a=isNaN(e.s)?<span class="number">0</span>:e.s-n,o=e.l-r;<span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(e)</span>{</span><span class="keyword">return</span> t.h=s+i*e,t.s=n+a*e,t.l=r+o*e,t+<span class="string">""</span>}}<span class="function"><span class="keyword">function</span> <span class="title">S</span><span class="params">(t,e)</span>{</span>t=h(t),e=h(e);<span class="keyword">var</span> s=isNaN(t.h)?e.h:t.h,n=isNaN(t.s)?e.s:t.s,r=t.l,i=isNaN(e.h)?<span class="number">0</span>:v(e.h,s),a=isNaN(e.s)?<span class="number">0</span>:e.s-n,o=e.l-r;<span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(e)</span>{</span><span class="keyword">return</span> t.h=s+i*e,t.s=n+a*e,t.l=r+o*e,t+<span class="string">""</span>}}<span class="function"><span class="keyword">function</span> <span class="title">j</span><span class="params">(t,e)</span>{</span>t=r(t),e=r(e);<span class="keyword">var</span> s=t.r,i=t.g,a=t.b,o=e.r-s,h=e.g-i,l=e.b-a;<span class="keyword">return</span> <span class="function"><span class="keyword">function</span><span class="params">(t)</span>{</span><span class="keyword">return</span> n(Math.round(s+o*t),Math.round(i+h*t),Math.round(a+l*t))}}e.prototype={toString:<span class="function"><span class="keyword">function</span><span class="params">()</span>{</span><span class="keyword">return</span> <span class="keyword">this</span>.rgb()+<span class="string">""</span>}};<span class="keyword">var</span> L=(<span class="keyword">new</span> Map).set(<span class="string">"aliceblue"</span>,<span class="number">15792383</span>).set(<span class="string">"antiquewhite"</span>,<span class="number">16444375</span>).set(<span class="string">"aqua"</span>,<span class="number">65535</span>).set(<span class="string">"aquamarine"</span>,<span class="number">8388564</span>).set(<span class="string">"azure"</span>,<span class="number">15794175</span>).set(<span class="string">"beige"</span>,<span class="number">16119260</span>).set(<span class="string">"bisque"</span>,<span class="number">16770244</span>).set(<span class="string">"black"</span>,<span class="number">0</span>).set(<span class="string">"blanchedalmond"</span>,<span class="number">16772045</span>).set(<span class="string">"blue"</span>,<span class="number">255</span>).set(<span class="string">"blueviolet"</span>,<span class="number">9055202</span>).set(<span class="string">"brown"</span>,<span class="number">10824234</span>).set(<span class="string">"burlywood"</span>,<span class="number">14596231</span>).set(<span class="string">"cadetblue"</span>,<span class="number">6266528</span>).set(<span class="string">"chartreuse"</span>,<span class="number">8388352</span>).set(<span class="string">"chocolate"</span>,<span class="number">13789470</span>).set(<span class="string">"coral"</span>,<span class="number">16744272</span>).set(<span class="string">"cornflowerblue"</span>,<span class="number">6591981</span>).set(<span class="string">"cornsilk"</span>,<span class="number">16775388</span>).set(<span class="string">"crimson"</span>,<span class="number">14423100</span>).set(<span class="string">"cyan"</span>,<span class="number">65535</span>).set(<span class="string">"darkblue"</span>,<span class="number">139</span>).set(<span class="string">"darkcyan"</span>,<span class="number">35723</span>).set(<span class="string">"darkgoldenrod"</span>,<span class="number">12092939</span>).set(<span class="string">"darkgray"</span>,<span class="number">11119017</span>).set(<span class="string">"darkgreen"</span>,<span class="number">25600</span>).set(<span class="string">"darkgrey"</span>,<span class="number">11119017</span>).set(<span class="string">"darkkhaki"</span>,<span class="number">12433259</span>).set(<span class="string">"darkmagenta"</span>,<span class="number">9109643</span>).set(<span class="string">"darkolivegreen"</span>,<span class="number">5597999</span>).set(<span class="string">"darkorange"</span>,<span class="number">16747520</span>).set(<span class="string">"darkorchid"</span>,<span class="number">10040012</span>).set(<span class="string">"darkred"</span>,<span class="number">9109504</span>).set(<span class="string">"darksalmon"</span>,<span class="number">15308410</span>).set(<span class="string">"darkseagreen"</span>,<span class="number">9419919</span>).set(<span class="string">"darkslateblue"</span>,<span class="number">4734347</span>).set(<span class="string">"darkslategray"</span>,<span class="number">3100495</span>).set(<span class="string">"darkslategrey"</span>,<span class="number">3100495</span>).set(<span class="string">"darkturquoise"</span>,<span class="number">52945</span>).set(<span class="string">"darkviolet"</span>,<span class="number">9699539</span>).set(<span class="string">"deeppink"</span>,<span class="number">16716947</span>).set(<span class="string">"deepskyblue"</span>,<span class="number">49151</span>).set(<span class="string">"dimgray"</span>,<span class="number">6908265</span>).set(<span class="string">"dimgrey"</span>,<span class="number">6908265</span>).set(<span class="string">"dodgerblue"</span>,<span class="number">2003199</span>).set(<span class="string">"firebrick"</span>,<span class="number">11674146</span>).set(<span class="string">"floralwhite"</span>,<span class="number">16775920</span>).set(<span class="string">"forestgreen"</span>,<span class="number">2263842</span>).set(<span class="string">"fuchsia"</span>,<span class="number">16711935</span>).set(<span class="string">"gainsboro"</span>,<span class="number">14474460</span>).set(<span class="string">"ghostwhite"</span>,<span class="number">16316671</span>).set(<span class="string">"gold"</span>,<span class="number">16766720</span>).set(<span class="string">"goldenrod"</span>,<span class="number">14329120</span>).set(<span class="string">"gray"</span>,<span class="number">8421504</span>).set(<span class="string">"green"</span>,<span class="number">32768</span>).set(<span class="string">"greenyellow"</span>,<span class="number">11403055</span>).set(<span class="string">"grey"</span>,<span class="number">8421504</span>).set(<span class="string">"honeydew"</span>,<span class="number">15794160</span>).set(<span class="string">"hotpink"</span>,<span class="number">16738740</span>).set(<span class="string">"indianred"</span>,<span class="number">13458524</span>).set(<span class="string">"indigo"</span>,<span class="number">4915330</span>).set(<span class="string">"ivory"</span>,<span class="number">16777200</span>).set(<span class="string">"khaki"</span>,<span class="number">15787660</span>).set(<span class="string">"lavender"</span>,<span class="number">15132410</span>).set(<span class="string">"lavenderblush"</span>,<span class="number">16773365</span>).set(<span class="string">"lawngreen"</span>,<span class="number">8190976</span>).set(<span class="string">"lemonchiffon"</span>,<span class="number">16775885</span>).set(<span class="string">"lightblue"</span>,<span class="number">11393254</span>).set(<span class="string">"lightcoral"</span>,<span class="number">15761536</span>).set(<span class="string">"lightcyan"</span>,<span class="number">14745599</span>).set(<span class="string">"lightgoldenrodyellow"</span>,<span class="number">16448210</span>).set(<span class="string">"lightgray"</span>,<span class="number">13882323</span>).set(<span class="string">"lightgreen"</span>,<span class="number">9498256</span>).set(<span class="string">"lightgrey"</span>,<span class="number">13882323</span>).set(<span class="string">"lightpink"</span>,<span class="number">16758465</span>).set(<span class="string">"lightsalmon"</span>,<span class="number">16752762</span>).set(<span class="string">"lightseagreen"</span>,<span class="number">2142890</span>).set(<span class="string">"lightskyblue"</span>,<span class="number">8900346</span>).set(<span class="string">"lightslategray"</span>,<span class="number">7833753</span>).set(<span class="string">"lightslategrey"</span>,<span class="number">7833753</span>).set(<span class="string">"lightsteelblue"</span>,<span class="number">11584734</span>).set(<span class="string">"lightyellow"</span>,<span class="number">16777184</span>).set(<span class="string">"lime"</span>,<span class="number">65280</span>).set(<span class="string">"limegreen"</span>,<span class="number">3329330</span>).set(<span class="string">"linen"</span>,<span class="number">16445670</span>).set(<span class="string">"magenta"</span>,<span class="number">16711935</span>).set(<span class="string">"maroon"</span>,<span class="number">8388608</span>).set(<span class="string">"mediumaquamarine"</span>,<span class="number">6737322</span>).set(<span class="string">"mediumblue"</span>,<span class="number">205</span>).set(<span class="string">"mediumorchid"</span>,<span class="number">12211667</span>).set(<span class="string">"mediumpurple"</span>,<span class="number">9662683</span>).set(<span class="string">"mediumseagreen"</span>,<span class="number">3978097</span>).set(<span class="string">"mediumslateblue"</span>,<span class="number">8087790</span>).set(<span class="string">"mediumspringgreen"</span>,<span class="number">64154</span>).set(<span class="string">"mediumturquoise"</span>,<span class="number">4772300</span>).set(<span class="string">"mediumvioletred"</span>,<span class="number">13047173</span>).set(<span class="string">"midnightblue"</span>,<span class="number">1644912</span>).set(<span class="string">"mintcream"</span>,<span class="number">16121850</span>).set(<span class="string">"mistyrose"</span>,<span class="number">16770273</span>).set(<span class="string">"moccasin"</span>,<span class="number">16770229</span>).set(<span class="string">"navajowhite"</span>,<span class="number">16768685</span>).set(<span class="string">"navy"</span>,<span class="number">128</span>).set(<span class="string">"oldlace"</span>,<span class="number">16643558</span>).set(<span class="string">"olive"</span>,<span class="number">8421376</span>).set(<span class="string">"olivedrab"</span>,<span class="number">7048739</span>).set(<span class="string">"orange"</span>,<span class="number">16753920</span>).set(<span class="string">"orangered"</span>,<span class="number">16729344</span>).set(<span class="string">"orchid"</span>,<span class="number">14315734</span>).set(<span class="string">"palegoldenrod"</span>,<span class="number">15657130</span>).set(<span class="string">"palegreen"</span>,<span class="number">10025880</span>).set(<span class="string">"paleturquoise"</span>,<span class="number">11529966</span>).set(<span class="string">"palevioletred"</span>,<span class="number">14381203</span>).set(<span class="string">"papayawhip"</span>,<span class="number">16773077</span>).set(<span class="string">"peachpuff"</span>,<span class="number">16767673</span>).set(<span class="string">"peru"</span>,<span class="number">13468991</span>).set(<span class="string">"pink"</span>,<span class="number">16761035</span>).set(<span class="string">"plum"</span>,<span class="number">14524637</span>).set(<span class="string">"powderblue"</span>,<span class="number">11591910</span>).set(<span class="string">"purple"</span>,<span class="number">8388736</span>).set(<span class="string">"rebeccapurple"</span>,<span class="number">6697881</span>).set(<span class="string">"red"</span>,<span class="number">16711680</span>).set(<span class="string">"rosybrown"</span>,<span class="number">12357519</span>).set(<span class="string">"royalblue"</span>,<span class="number">4286945</span>).set(<span class="string">"saddlebrown"</span>,<span class="number">9127187</span>).set(<span class="string">"salmon"</span>,<span class="number">16416882</span>).set(<span class="string">"sandybrown"</span>,<span class="number">16032864</span>).set(<span class="string">"seagreen"</span>,<span class="number">3050327</span>).set(<span class="string">"seashell"</span>,<span class="number">16774638</span>).set(<span class="string">"sienna"</span>,<span class="number">10506797</span>).set(<span class="string">"silver"</span>,<span class="number">12632256</span>).set(<span class="string">"skyblue"</span>,<span class="number">8900331</span>).set(<span class="string">"slateblue"</span>,<span class="number">6970061</span>).set(<span class="string">"slategray"</span>,<span class="number">7372944</span>).set(<span class="string">"slategrey"</span>,<span class="number">7372944</span>).set(<span class="string">"snow"</span>,<span class="number">16775930</span>).set(<span class="string">"springgreen"</span>,<span class="number">65407</span>).set(<span class="string">"steelblue"</span>,<span class="number">4620980</span>).set(<span class="string">"tan"</span>,<span class="number">13808780</span>).set(<span class="string">"teal"</span>,<span class="number">32896</span>).set(<span class="string">"thistle"</span>,<span class="number">14204888</span>).set(<span class="string">"tomato"</span>,<span class="number">16737095</span>).set(<span class="string">"turquoise"</span>,<span class="number">4251856</span>).set(<span class="string">"violet"</span>,<span class="number">15631086</span>).set(<span class="string">"wheat"</span>,<span class="number">16113331</span>).set(<span class="string">"white"</span>,<span class="number">16777215</span>).set(<span class="string">"whitesmoke"</span>,<span class="number">16119285</span>).set(<span class="string">"yellow"</span>,<span class="number">16776960</span>).set(<span class="string">"yellowgreen"</span>,<span class="number">10145074</span>),$=s.prototype=<span class="keyword">new</span> e,H=.<span class="number">7</span>;$.darker=<span class="function"><span class="keyword">function</span><span class="params">(t)</span>{</span><span class="keyword">return</span> t=<span class="literal">null</span>==t?H:Math.pow(H,t),<span class="keyword">new</span> s(<span class="keyword">this</span>.r*t,<span class="keyword">this</span>.g*t,<span class="keyword">this</span>.b*t)};<span class="keyword">var</span> I=<span class="number">1</span>/H;$.brighter=<span class="function"><span class="keyword">function</span><span class="params">(t)</span>{</span><span class="keyword">return</span> t=<span class="literal">null</span>==t?I:Math.pow(I,t),<span class="keyword">new</span> s(<span class="keyword">this</span>.r*t,<span class="keyword">this</span>.g*t,<span class="keyword">this</span>.b*t)},$.rgb=<span class="function"><span class="keyword">function</span><span class="params">()</span>{</span><span class="keyword">return</span> <span class="keyword">this</span>},$.toString=<span class="function"><span class="keyword">function</span><span class="params">()</span>{</span><span class="keyword">return</span> n(<span class="keyword">this</span>.r,<span class="keyword">this</span>.g,<span class="keyword">this</span>.b)};<span class="keyword">var</span> C=a.prototype=<span class="keyword">new</span> e;C.brighter=<span class="function"><span class="keyword">function</span><span class="params">(t)</span>{</span><span class="keyword">return</span> t=<span class="literal">null</span>==t?I:Math.pow(I,t),<span class="keyword">new</span> a(<span class="keyword">this</span>.h,<span class="keyword">this</span>.s,<span class="keyword">this</span>.l*t)},C.darker=<span class="function"><span class="keyword">function</span><span class="params">(t)</span>{</span><span class="keyword">return</span> t=<span class="literal">null</span>==t?H:Math.pow(H,t),<span class="keyword">new</span> a(<span class="keyword">this</span>.h,<span class="keyword">this</span>.s,<span class="keyword">this</span>.l*t)},C.rgb=<span class="function"><span class="keyword">function</span><span class="params">()</span>{</span><span class="keyword">var</span> t=<span class="keyword">this</span>.h%<span class="number">360</span>+<span class="number">360</span>*(<span class="keyword">this</span>.h&lt;<span class="number">0</span>),e=isNaN(t)||isNaN(<span class="keyword">this</span>.s)?<span class="number">0</span>:<span class="keyword">this</span>.s,n=<span class="keyword">this</span>.l,r=.<span class="number">5</span>&gt;=n?n*(<span class="number">1</span>+e):n+e-n*e,i=<span class="number">2</span>*n-r;<span class="keyword">return</span> <span class="keyword">new</span> s(o(t&gt;=<span class="number">240</span>?t-<span class="number">240</span>:t+<span class="number">120</span>,i,r),o(t,i,r),o(<span class="number">120</span>&gt;t?t+<span class="number">240</span>:t-<span class="number">120</span>,i,r))};<span class="keyword">var</span> O=<span class="regexp">/^hsl\(\s*([-+]?\d+(?:\.\d+)?)\s*,\s*([-+]?\d+(?:\.\d+)?)%\s*,\s*([-+]?\d+(?:\.\d+)?)%\s*\)$/</span>,P=<span class="regexp">/^rgb\(\s*([-+]?\d+(?:\.\d+)?)%\s*,\s*([-+]?\d+(?:\.\d+)?)%\s*,\s*([-+]?\d+(?:\.\d+)?)%\s*\)$/</span>,z=<span class="regexp">/^rgb\(\s*([-+]?\d+)\s*,\s*([-+]?\d+)\s*,\s*([-+]?\d+)\s*\)$/</span>,E=<span class="regexp">/^#([0-9a-f]{6})$/</span>,R=<span class="regexp">/^#([0-9a-f]{3})$/</span>;l.prototype=e.prototype,r.prototype=s.prototype,h.prototype=a.prototype;<span class="keyword">var</span> A=u.prototype=<span class="keyword">new</span> e,B=<span class="number">18</span>;A.brighter=<span class="function"><span class="keyword">function</span><span class="params">(t)</span>{</span><span class="keyword">return</span> <span class="keyword">new</span> u(<span class="keyword">this</span>.l+B*(<span class="literal">null</span>==t?<span class="number">1</span>:t),<span class="keyword">this</span>.a,<span class="keyword">this</span>.b)},A.darker=<span class="function"><span class="keyword">function</span><span class="params">(t)</span>{</span><span class="keyword">return</span> <span class="keyword">new</span> u(<span class="keyword">this</span>.l-B*(<span class="literal">null</span>==t?<span class="number">1</span>:t),<span class="keyword">this</span>.a,<span class="keyword">this</span>.b)};<span class="keyword">var</span> D=<span class="number">4</span>/<span class="number">29</span>,F=<span class="number">6</span>/<span class="number">29</span>,G=<span class="number">3</span>*F*F,J=<span class="number">1.08883</span>,K=.<span class="number">95047</span>,Q=<span class="number">1</span>;A.rgb=<span class="function"><span class="keyword">function</span><span class="params">()</span>{</span><span class="keyword">var</span> t=(<span class="keyword">this</span>.l+<span class="number">16</span>)/<span class="number">116</span>,e=isNaN(<span class="keyword">this</span>.a)?t:t+<span class="keyword">this</span>.a/<span class="number">500</span>,n=isNaN(<span class="keyword">this</span>.b)?t:t-<span class="keyword">this</span>.b/<span class="number">200</span>;<span class="keyword">return</span> t=Q*g(t),e=K*g(e),n=J*g(n),<span class="keyword">new</span> s(c(<span class="number">3.2404542</span>*e-<span class="number">1.5371385</span>*t-.<span class="number">4985314</span>*n),c(-.<span class="number">969266</span>*e+<span class="number">1.8760108</span>*t+.<span class="number">041556</span>*n),c(.<span class="number">0556434</span>*e-.<span class="number">2040259</span>*t+<span class="number">1.0572252</span>*n))};<span class="keyword">var</span> T=F*F*F,U=Math.PI/<span class="number">180</span>,V=p.prototype=<span class="keyword">new</span> e;V.brighter=<span class="function"><span class="keyword">function</span><span class="params">(t)</span>{</span><span class="keyword">return</span> <span class="keyword">new</span> p(<span class="keyword">this</span>.h,<span class="keyword">this</span>.c,<span class="keyword">this</span>.l+B*(<span class="literal">null</span>==t?<span class="number">1</span>:t))},V.darker=<span class="function"><span class="keyword">function</span><span class="params">(t)</span>{</span><span class="keyword">return</span> <span class="keyword">new</span> p(<span class="keyword">this</span>.h,<span class="keyword">this</span>.c,<span class="keyword">this</span>.l-B*(<span class="literal">null</span>==t?<span class="number">1</span>:t))},V.rgb=<span class="function"><span class="keyword">function</span><span class="params">()</span>{</span><span class="keyword">return</span> b(<span class="keyword">this</span>).rgb()},b.prototype=u.prototype;<span class="keyword">var</span> W=<span class="number">180</span>/Math.PI;N.prototype=p.prototype;<span class="keyword">var</span> X=m.prototype=<span class="keyword">new</span> e;X.brighter=<span class="function"><span class="keyword">function</span><span class="params">(t)</span>{</span><span class="keyword">return</span> t=<span class="literal">null</span>==t?I:Math.pow(I,t),<span class="keyword">new</span> m(<span class="keyword">this</span>.h,<span class="keyword">this</span>.s,<span class="keyword">this</span>.l*t)},X.darker=<span class="function"><span class="keyword">function</span><span class="params">(t)</span>{</span><span class="keyword">return</span> t=<span class="literal">null</span>==t?H:Math.pow(H,t),<span class="keyword">new</span> m(<span class="keyword">this</span>.h,<span class="keyword">this</span>.s,<span class="keyword">this</span>.l*t)};<span class="keyword">var</span> Y=<span class="number">1.97294</span>,Z=-.<span class="number">90649</span>,tt=-.<span class="number">29227</span>,et=<span class="number">1.78277</span>,st=-.<span class="number">14861</span>,nt=<span class="number">1</span>,rt=Y*et,it=Y*Z,at=et*tt-Z*st;X.rgb=<span class="function"><span class="keyword">function</span><span class="params">()</span>{</span><span class="keyword">var</span> t=isNaN(<span class="keyword">this</span>.h)?<span class="number">0</span>:(<span class="keyword">this</span>.h+<span class="number">120</span>)*U,e=Math.pow(<span class="keyword">this</span>.l,nt),n=isNaN(<span class="keyword">this</span>.s)?<span class="number">0</span>:<span class="keyword">this</span>.s*e*(<span class="number">1</span>-e),r=Math.cos(t),i=Math.sin(t);<span class="keyword">return</span> <span class="keyword">new</span> s(<span class="number">255</span>*(e+n*(st*r+et*i)),<span class="number">255</span>*(e+n*(tt*r+Z*i)),<span class="number">255</span>*(e+n*Y*r))},w.prototype=m.prototype,t.color=l,t.rgb=r,t.hsl=h,t.lab=b,t.hcl=N,t.cubehelix=w,t.interpolateRgb=j,t.interpolateHsl=S,t.interpolateHslLong=_,t.interpolateLab=q,t.interpolateHcl=x,t.interpolateHclLong=k,t.interpolateCubehelix=M,t.interpolateCubehelixLong=y});

<span class="keyword">var</span> canvas = document.querySelector(<span class="string">"canvas"</span>),
    width = canvas.width,
    height = canvas.height,
    context = canvas.getContext(<span class="string">"2d"</span>),
    voro = voronoi.voronoi().extent([[<span class="number">0.5</span>, <span class="number">0.5</span>], [width - <span class="number">0.5</span>, height - <span class="number">0.5</span>]]);

<span class="keyword">var</span> rainbow1 = color.interpolateCubehelixLong(color.cubehelix(-<span class="number">100</span>, <span class="number">0.75</span>, <span class="number">0.35</span>), color.cubehelix(<span class="number">80</span>, <span class="number">1.50</span>, <span class="number">0.8</span>)),
    rainbow2 = color.interpolateCubehelixLong(color.cubehelix(<span class="number">80</span>, <span class="number">1.50</span>, <span class="number">0.8</span>), color.cubehelix(<span class="number">260</span>, <span class="number">0.75</span>, <span class="number">0.35</span>));

<span class="keyword">var</span> n = <span class="number">50</span>,
    particles = <span class="keyword">new</span> Array(n),
    radius = <span class="number">20</span>;

<span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; n; ++i) particles[i] = {<span class="number">0</span>: Math.random() * width, <span class="number">1</span>: Math.random() * height, vx: <span class="number">0</span>, vy: <span class="number">0</span>};

timer.timer(<span class="function"><span class="keyword">function</span><span class="params">(elapsed)</span> {</span>
  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; n; ++i) {
    <span class="keyword">var</span> p = particles[i];
    p[<span class="number">0</span>] += p.vx; <span class="keyword">if</span> (p[<span class="number">0</span>] &lt; <span class="number">0</span>) p[<span class="number">0</span>] = p.vx *= -<span class="number">1</span>; <span class="keyword">else</span> <span class="keyword">if</span> (p[<span class="number">0</span>] &gt; width) p[<span class="number">0</span>] = width + (p.vx *= -<span class="number">1</span>);
    p[<span class="number">1</span>] += p.vy; <span class="keyword">if</span> (p[<span class="number">1</span>] &lt; <span class="number">0</span>) p[<span class="number">1</span>] = p.vy *= -<span class="number">1</span>; <span class="keyword">else</span> <span class="keyword">if</span> (p[<span class="number">1</span>] &gt; height) p[<span class="number">1</span>] = height + (p.vy *= -<span class="number">1</span>);
    p.vx += <span class="number">0.1</span> * (Math.random() - .<span class="number">5</span>) - <span class="number">0.01</span> * p.vx;
    p.vy += <span class="number">0.1</span> * (Math.random() - .<span class="number">5</span>) - <span class="number">0.01</span> * p.vy;
  }

  <span class="keyword">var</span> cells = voro(particles);

  context.beginPath();
  cells.forEach(<span class="function"><span class="keyword">function</span><span class="params">(cell)</span> {</span> drawRoundedPolygon(cell, radius); });
  context.globalAlpha = <span class="number">0.2</span>;
  context.lineWidth = <span class="number">4</span>;
  context.strokeStyle = <span class="string">"#000"</span>;
  context.stroke();

  context.beginPath();
  cells.forEach(<span class="function"><span class="keyword">function</span><span class="params">(cell)</span> {</span> drawRoundedPolygon(cell, radius); });
  context.globalAlpha = <span class="number">1</span>;
  <span class="keyword">var</span> t = (elapsed / <span class="number">5000</span>) % <span class="number">2</span>;
  context.strokeStyle = t &gt; <span class="number">1</span> ? rainbow2(t - <span class="number">1</span>) : rainbow1(t);
  context.lineWidth = <span class="number">1.5</span>;
  context.stroke();
});

<span class="function"><span class="keyword">function</span> <span class="title">drawPoint</span><span class="params">(point)</span> {</span>
  context.moveTo(point[<span class="number">0</span>] + <span class="number">1.5</span>, point[<span class="number">1</span>]);
  context.arc(point[<span class="number">0</span>], point[<span class="number">1</span>], <span class="number">1.5</span>, <span class="number">0</span>, <span class="number">2</span> * Math.PI);
}

<span class="function"><span class="keyword">function</span> <span class="title">drawPolygon</span><span class="params">(points)</span> {</span>
  context.moveTo(points[<span class="number">0</span>][<span class="number">0</span>], points[<span class="number">0</span>][<span class="number">1</span>]);
  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">1</span>, n = points.length; i &lt; n; ++i) context.lineTo(points[i][<span class="number">0</span>], points[i][<span class="number">1</span>]);
  context.closePath();
}

<span class="function"><span class="keyword">function</span> <span class="title">drawRoundedPolygon</span><span class="params">(points, r)</span> {</span>
  <span class="keyword">var</span> i,
      n = points.length,
      p0,
      p1,
      p2,
      p3,
      n1 = <span class="number">0</span>,
      t012,
      t123,
      x21, y21,
      x4, y4,
      x5, y5,
      moved,
      circle = polygonIncircle(points);

  <span class="comment">// Build a linked list from the array of vertices so we can splice.</span>
  <span class="keyword">for</span> (i = <span class="number">0</span>, p1 = points[n - <span class="number">2</span>], p2 = points[n - <span class="number">1</span>]; i &lt; n; ++i) {
    p0 = p1, p1 = p2, p2 = points[i];
    p1.previous = p0;
    p1.next = p2;
  }

  <span class="comment">// The rounding radius canâ€™t be bigger than the polygonâ€™s incircle.</span>
  <span class="comment">// The fudge factor of 1px lets the rounded polygon get squished a bit.</span>
  <span class="comment">// TODO Abort the search for the incircle if one is found larger than r.</span>
  r = Math.min(r, circle.radius - <span class="number">1</span>);
  <span class="keyword">if</span> (r &lt;= <span class="number">0</span>) <span class="keyword">return</span>;

  <span class="comment">// TODO do we need to make all these extra passes?</span>
  <span class="keyword">for</span> (i = <span class="number">0</span>, p3 = p2.next; n1 &lt;= n; ++n1) {
    p0 = p1, p1 = p2, p2 = p3, p3 = p3.next;
    t012 = cornerTangent(p0[<span class="number">0</span>], p0[<span class="number">1</span>], p1[<span class="number">0</span>], p1[<span class="number">1</span>], p2[<span class="number">0</span>], p2[<span class="number">1</span>], r);
    t123 = <span class="number">1</span> - cornerTangent(p3[<span class="number">0</span>], p3[<span class="number">1</span>], p2[<span class="number">0</span>], p2[<span class="number">1</span>], p1[<span class="number">0</span>], p1[<span class="number">1</span>], r);

    <span class="comment">// If the following cornerâ€™s tangent is before this cornerâ€™s tangent,</span>
    <span class="comment">// replace p1 and p2 with the intersection of the lines 01 and 23.</span>
    <span class="keyword">if</span> (t012 &gt;= t123) {
      p2 = p0.next = p3.previous = lineLineIntersection(p0[<span class="number">0</span>], p0[<span class="number">1</span>], p1[<span class="number">0</span>], p1[<span class="number">1</span>], p2[<span class="number">0</span>], p2[<span class="number">1</span>], p3[<span class="number">0</span>], p3[<span class="number">1</span>]);
      p2.previous = p0;
      p2.next = p3;
      p3 = p2;
      p2 = p3.previous;
      p1 = p2.previous;
      p0 = p1.previous;
      n1 = <span class="number">0</span>;
      <span class="keyword">if</span> (--n &lt; <span class="number">3</span>) <span class="keyword">break</span>;
    }
  }

  <span class="comment">// If we removed too many points, just draw the previously computed incircle.</span>
  <span class="keyword">if</span> (n &lt; <span class="number">3</span>) {
    context.moveTo(circle[<span class="number">0</span>] + circle.radius, circle[<span class="number">1</span>]);
    context.arc(circle[<span class="number">0</span>], circle[<span class="number">1</span>], circle.radius, <span class="number">0</span>, <span class="number">2</span> * Math.PI);
    <span class="keyword">return</span>;
  }

  <span class="comment">// Draw the rounded polygon, compting the corner tangents.</span>
  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt;= n; ++i) {
    p0 = p1, p1 = p2, p2 = p3, p3 = p3.next;
    t012 = cornerTangent(p0[<span class="number">0</span>], p0[<span class="number">1</span>], p1[<span class="number">0</span>], p1[<span class="number">1</span>], p2[<span class="number">0</span>], p2[<span class="number">1</span>], r);
    t123 = <span class="number">1</span> - cornerTangent(p3[<span class="number">0</span>], p3[<span class="number">1</span>], p2[<span class="number">0</span>], p2[<span class="number">1</span>], p1[<span class="number">0</span>], p1[<span class="number">1</span>], r);
    x21 = p2[<span class="number">0</span>] - p1[<span class="number">0</span>], y21 = p2[<span class="number">1</span>] - p1[<span class="number">1</span>];
    x4 = p1[<span class="number">0</span>] + t012 * x21, y4 = p1[<span class="number">1</span>] + t012 * y21;
    x5 = p1[<span class="number">0</span>] + t123 * x21, y5 = p1[<span class="number">1</span>] + t123 * y21;
    <span class="keyword">if</span> (moved) context.arcTo(p1[<span class="number">0</span>], p1[<span class="number">1</span>], x4, y4, r);
    <span class="keyword">else</span> moved = <span class="literal">true</span>, context.moveTo(x4, y4);
    context.lineTo(x5, y5);
  }
}

<span class="comment">// Given a circle of radius r that is tangent to the line segments 01 and 12,</span>
<span class="comment">// returns the parameter t of the tangent along the line segment 12.</span>
<span class="function"><span class="keyword">function</span> <span class="title">cornerTangent</span><span class="params">(x0, y0, x1, y1, x2, y2, r)</span> {</span>
  <span class="keyword">var</span> theta = innerAngle(x0, y0, x1, y1, x2, y2),
      x21 = x2 - x1, y21 = y2 - y1,
      l21 = Math.sqrt(x21 * x21 + y21 * y21),
      l14 = r / Math.tan(theta / <span class="number">2</span>);
  <span class="keyword">return</span> l14 / l21;
}

<span class="comment">// A horrible brute-force algorithm for determining the largest circle that can</span>
<span class="comment">// fit inside a convex polygon. For each distinct set of three sides of the</span>
<span class="comment">// polygon, compute the tangent circle. Then reduce the circleâ€™s radius against</span>
<span class="comment">// the remaining sides of the polygon.</span>
<span class="function"><span class="keyword">function</span> <span class="title">polygonIncircle</span><span class="params">(points)</span> {</span>
  <span class="keyword">var</span> circle = {radius: <span class="number">0</span>};

  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, n = points.length; i &lt; n; ++i) {
    <span class="keyword">var</span> pi0 = points[i],
        pi1 = points[(i + <span class="number">1</span>) % n];
    <span class="keyword">for</span> (<span class="keyword">var</span> j = i + <span class="number">1</span>; j &lt; n; ++j) {
      <span class="keyword">var</span> pj0 = points[j],
          pj1 = points[(j + <span class="number">1</span>) % n],
          pij = j === i + <span class="number">1</span> ? pj0 : lineLineIntersection(pi0[<span class="number">0</span>], pi0[<span class="number">1</span>], pi1[<span class="number">0</span>], pi1[<span class="number">1</span>], pj0[<span class="number">0</span>], pj0[<span class="number">1</span>], pj1[<span class="number">0</span>], pj1[<span class="number">1</span>]);
      search: <span class="keyword">for</span> (<span class="keyword">var</span> k = j + <span class="number">1</span>; k &lt; n; ++k) {
        <span class="keyword">var</span> pk0 = points[k],
            pk1 = points[(k + <span class="number">1</span>) % n],
            pik = lineLineIntersection(pi0[<span class="number">0</span>], pi0[<span class="number">1</span>], pi1[<span class="number">0</span>], pi1[<span class="number">1</span>], pk0[<span class="number">0</span>], pk0[<span class="number">1</span>], pk1[<span class="number">0</span>], pk1[<span class="number">1</span>]),
            pjk = k === j + <span class="number">1</span> ? pk0 : lineLineIntersection(pj0[<span class="number">0</span>], pj0[<span class="number">1</span>], pj1[<span class="number">0</span>], pj1[<span class="number">1</span>], pk0[<span class="number">0</span>], pk0[<span class="number">1</span>], pk1[<span class="number">0</span>], pk1[<span class="number">1</span>]),
            candidate = triangleIncircle(pij[<span class="number">0</span>], pij[<span class="number">1</span>], pik[<span class="number">0</span>], pik[<span class="number">1</span>], pjk[<span class="number">0</span>], pjk[<span class="number">1</span>]),
            radius = candidate.radius;

        <span class="keyword">for</span> (<span class="keyword">var</span> l = <span class="number">0</span>; l &lt; n; ++l) {
          <span class="keyword">var</span> pl0 = points[l],
              pl1 = points[(l + <span class="number">1</span>) % n],
              r = pointLineDistance(candidate[<span class="number">0</span>], candidate[<span class="number">1</span>], pl0[<span class="number">0</span>], pl0[<span class="number">1</span>], pl1[<span class="number">0</span>], pl1[<span class="number">1</span>]);
          <span class="keyword">if</span> (r &lt; circle.radius) <span class="keyword">continue</span> search;
          <span class="keyword">if</span> (r &lt; radius) radius = r;
        }

        circle = candidate;
        circle.radius = radius;
      }
    }
  }

  <span class="keyword">return</span> circle;
}

<span class="comment">// Returns the angle between segments 01 and 12.</span>
<span class="function"><span class="keyword">function</span> <span class="title">innerAngle</span><span class="params">(x0, y0, x1, y1, x2, y2)</span> {</span>
  <span class="keyword">var</span> x01 = x0 - x1, y01 = y0 - y1,
      x12 = x1 - x2, y12 = y1 - y2,
      x02 = x0 - x2, y02 = y0 - y2,
      l01_2 = x01 * x01 + y01 * y01,
      l12_2 = x12 * x12 + y12 * y12,
      l02_2 = x02 * x02 + y02 * y02;
  <span class="keyword">return</span> Math.acos((l12_2 + l01_2 - l02_2) / (<span class="number">2</span> * Math.sqrt(l12_2 * l01_2)));
}

<span class="comment">// Returns the intersection of the infinite lines 01 and 23.</span>
<span class="function"><span class="keyword">function</span> <span class="title">lineLineIntersection</span><span class="params">(x0, y0, x1, y1, x2, y2, x3, y3)</span> {</span>
  <span class="keyword">var</span> x02 = x0 - x2, y02 = y0 - y2,
      x10 = x1 - x0, y10 = y1 - y0,
      x32 = x3 - x2, y32 = y3 - y2,
      t = (x32 * y02 - y32 * x02) / (y32 * x10 - x32 * y10);
  <span class="keyword">return</span> [x0 + t * x10, y0 + t * y10];
}

<span class="comment">// Returns the signed distance from point 0 to the infinite line 12.</span>
<span class="function"><span class="keyword">function</span> <span class="title">pointLineDistance</span><span class="params">(x0, y0, x1, y1, x2, y2)</span> {</span>
  <span class="keyword">var</span> x21 = x2 - x1, y21 = y2 - y1;
  <span class="keyword">return</span> (y21 * x0 - x21 * y0 + x2 * y1 - y2 * x1) / Math.sqrt(y21 * y21 + x21 * x21);
}

<span class="comment">// Returns the largest circle inside the triangle 012.</span>
<span class="function"><span class="keyword">function</span> <span class="title">triangleIncircle</span><span class="params">(x0, y0, x1, y1, x2, y2)</span> {</span>
  <span class="keyword">var</span> x01 = x0 - x1, y01 = y0 - y1,
      x02 = x0 - x2, y02 = y0 - y2,
      x12 = x1 - x2, y12 = y1 - y2,
      l01 = Math.sqrt(x01 * x01 + y01 * y01),
      l02 = Math.sqrt(x02 * x02 + y02 * y02),
      l12 = Math.sqrt(x12 * x12 + y12 * y12),
      k0 = l01 / (l01 + l02),
      k1 = l12 / (l12 + l01),
      center = lineLineIntersection(x0, y0, x1 - k0 * x12, y1 - k0 * y12, x1, y1, x2 + k1 * x02, y2 + k1 * y02);
  center.radius = Math.sqrt((l02 + l12 - l01) * (l12 + l01 - l02) * (l01 + l02 - l12) / (l01 + l02 + l12)) / <span class="number">2</span>;
  <span class="keyword">return</span> center;
}

</span><span class="tag">&lt;/<span class="title">script</span>&gt;</span>
</code></pre></div></div>

<script src="./Colorcomb II_files/d3.min.js"></script>
<script src="./Colorcomb II_files/highlight.min.js"></script>
<script>

var gist = {"history":[{"version":"6316459700ccccc72e4701a0395e054cfefd67da"}],"files":{"index.html":{"language":"HTML","type":"text/html","filename":"index.html","size":28889,"sha":"83d35c134278ac75912e27f6d2a26cb53d8c02f2"},"thumbnail.png":{"language":null,"type":"image/png","filename":"thumbnail.png","size":70336,"sha":"a668f9c1749bb14746b218f4a3fa8872b7c3cf2e"}},"created_at":"2015-07-10T00:29:44.000Z","updated_at":"2015-07-10T23:52:00.000Z","description":"Colorcomb II","owner":{"login":"mbostock"},"id":"85d7dce6fca6277f75fe"};

var files = d3.values(gist.files)
    .sort(function(a, b) { return (b.filename === "index.html") - (a.filename === "index.html") || a.filename.localeCompare(b.filename); });

var readme = d3.selectAll(".gist-readme")
    .data(files.filter(function(d) { return /^readme\b/i.test(d.filename) && d.language === "Markdown"; }))
    .each(function(d) {
      var readme = d3.select(this);
      d3.text("/mbostock/raw/85d7dce6fca6277f75fe/6316459700ccccc72e4701a0395e054cfefd67da/" + d.filename, function(error, content) {
        readme.html(new Showdown.converter().makeHtml(content));
        readme.selectAll("code").each(function() { hljs.highlightBlock(this); });
      });
    });

var source = d3.select(".gist-sources").selectAll(".gist-source")
    .data(files.filter(function(d) { return !/^readme\b/i.test(d.filename) && d.size < 50000 && text(d.type); }))
  .enter().append("div")
    .attr("class", "gist-source");

source.append("h2")
    .text(function(d) { return d.filename; })
  .append("a")
    .attr("name", function(d) { return d.filename; })
    .attr("href", function(d) { return "#" + d.filename; })
    .text("#");

source.append("pre").append("code")
    .attr("class", function(d) { return d.language && (d.language === "JSON" ? "javascript" : d.language.toLowerCase()); })
    .each(function(d) {
      var code = d3.select(this);
      d3.text("/mbostock/raw/85d7dce6fca6277f75fe/6316459700ccccc72e4701a0395e054cfefd67da/" + (d.filename === "index.html" ? "" : d.filename), function(error, content) {
        code.text(content);
        hljs.highlightBlock(code.node());
      });
    });

function text(type) {
  return /(^text\/)|(^application\/(javascript|json)$)|(^image\/svg$)|(\+xml$)/.test(type);
}

</script>

<footer>
  <a href="http://bl.ocks.org/mbostock">mbostock</a>â€™s block
  <a class="gist" title="View gist #85d7dce6fca6277f75fe on GitHub" href="https://gist.github.com/mbostock/85d7dce6fca6277f75fe">#85d7dce6fca6277f75fe</a>
  <span class="date">July 10, 2015</span>
</footer>

<script>

GoogleAnalyticsObject = "ga", ga = function() { ga.q.push(arguments); }, ga.q = [], ga.l = +new Date;
ga("create", "UA-48272912-1", "auto");
ga("send", "pageview");

</script>
<script async="" src="./Colorcomb II_files/analytics.js"></script>
</body></html>